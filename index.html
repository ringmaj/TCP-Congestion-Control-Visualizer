<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Majok Francis Ring</title>
    <!-- Bootstrap -->
    <link href='https://fonts.googleapis.com/css?family=Lato:400,300italic' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Condensed" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
    <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
    <link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
    <link rel="stylesheet" href="main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.typeit/4.4.0/typeit.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

</head>

<body>


    <!--------------------------- NAV BAR-------------------------------------------------------------->
    <nav class="navbar navbar-default navbar-fixed-top" id="navB">
        <div class="container" id="navc">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
                <a class="navbar-brand" href="#"></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">

                    <li class="active"><a href="#top">Home</a></li>
                    <li id="aboutButton"><a href="#aboutMe">AIMD</a></li>
                    <li><a href="#experience-container">Slow Start</a></li>

                    <li><a href="#pdf-container">Tutorial</a></li>

                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li id="timeline-tab"><a href="#timeline-container">LinkedIn</a></li>
                    <li><a href="#empty">GitHub <span class="sr-only">(current)</span></a></li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>
    <!------------------------------------------------------------------------------------------------->



    <!-- Packet List-->
    <div id="packetSelector" class="noselect">

        <!------------------------------------------------------------------------------------------------->
        <!-- Select how many packets are being sent-->
        <div class="conatainer numPacketsSelector">
            <div id="numPacketsField">Number of packets sent <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
            </div>

            <form id="numPacketSentForm" onsubmit="initPackets(); return false">
                <input id="numberField" type="number" name="numberOfPacketsSent" placeholder="?">
            </form>
        </div>
        <!------------------------------------------------------------------------------------------------->
        <ul id="packetList">
            <li id="packetsSent">Packets sent <span class="	glyphicon glyphicon-send	Try it
" aria-hidden="true"></span></li>
            <li>1</li>
            <li>2</li>
            <li>3</li>
            <li>4</li>
        </ul>
        <!------------------------------------------------------------------------------------------------->
        <ul id="packetDroppedList">
            <li id="packetsDropped">Packets dropped <span class="glyphicon">&#xe014;</span></li>
        </ul>
        <!------------------------------------------------------------------------------------------------->
        <canvas id="myChart" width="1500" height="450"></canvas>
        <!------------------------------------------------------------------------------------------------->


        <!--
        Script to control packet selection and dropped packets
        <script src="JavaScript/PacketControl.js"></script>
-->


        <script>
            var ctx = document.getElementById("myChart").getContext('2d');
            var rttNum = [1];
            for (var i = 2; i < 10; i++) {
                rttNum.push(i);
            }
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: rttNum,
                    datasets: [
//                         {fill: 'origin'},
                        {
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        label: "AIMD",
                        borderColor: "#3e95cd",
                        fill: false
                    }, {
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        label: "Slow Start",
                        borderColor: "#8e5ea2",
                        fill: false
                    }]
                },
                options: {

                    title: {
                        display: true,
                        text: 'TCP Congestion Control Methods'
                    },
                    scales: {
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'RTT',
                                fontColor: '#555555',
                                fontStyle: "bold"
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Congestion Window',
                                fontColor: '#555555',
                                fontStyle: "bold"
                            }
                        }]
                    },
                    elements: {
                        line: {
                            tension: 0
                        }
                    }
                }
            });




            function addData(chart, label, data) {
                chart.data.labels.push(label);
                chart.data.datasets.forEach((dataset) => {
                    dataset.data.push(data);
                });
                chart.update();
            }

            function removeData(chart) {
                chart.data.labels = [];
                chart.data.datasets[0] = [];
                chart.data.datasets[1] = [];

                chart.update();
                console.log("removed data?");
            }

            //  removeData(myChart);


            var dataPushed = {
                data: [3000, 0, 0, 0, 0, 0, 133, 221, 783, 2478],
                label: "New Data",
                borderColor: "#3e95cd",
                fill: false
            };



            //            addData(myChart, "new label", dataPushed);
            //removeData(myChart);

            //myChart.data.pop();
            //            myChart.data.datasets[0].label = "work?";
            // myChart.update();



            // Global variables 
            var droppedSize = document.getElementById("packetDroppedList").getElementsByTagName("li").length - 1;
            var packetsDroppedArray = new Array(droppedSize);

            // Function to initialize a number of packets sent
            function initPackets() {
                packetsDroppedArray = [];
                var numPackets = Number(document.forms[0].numberOfPacketsSent.value);
                var size = document.getElementById("packetList").getElementsByTagName("li").length;
                //    alert("The form was submitted: " + numPackets + "  SIZE: "+ size); 
                // Clear our packetlist by removing all child nodes

                var myNode = document.getElementById("packetDroppedList");

                while (document.getElementById("packetDroppedList").getElementsByTagName("li").length > 1) {
                    myNode.removeChild(myNode.lastChild);
                }

                myNode = document.getElementById("packetList");

                while (document.getElementById("packetList").getElementsByTagName("li").length > 1) {
                    myNode.removeChild(myNode.lastChild);
                }


                // Add the number of packets selected
                for (var i = 0; i < numPackets; i++) {
                    var node = document.createElement("li");
                    var textnode = document.createTextNode(i + 1);
                    node.appendChild(textnode);
                    document.getElementById("packetList").appendChild(node);
                }

                var aimdData = AIMD(packetsDroppedArray);
                var aimdLabel = new Array();
                for (var i = 1; i < aimdData.length; i++) {
                    aimdLabel.push(i);
                }
                myChart.data.datasets[0].data = aimdData;
                myChart.data.datasets[0].data = aimdData;
                myChart.data.labels = aimdLabel;
                myChart.update();
            }

            function AIMD(packetsDroppedArray) {
                var congestionWindow = 1;
                var RTT = 1;
                var lastPacketSent = 1;
                var totalToSend = Number(document.forms[0].numberOfPacketsSent.value);
                var currentlySendArray = new Array();
                var packetsDroppedArr = packetsDroppedArray.slice();
                var outputData = new Array();


                function isDropped(packetNum) {
                    var dropped = false;

                    for (var i = 0; i < packetsDroppedArr.length; i++) {
                        if (packetsDroppedArr[i] == packetNum) {
                            dropped = true;
                            packetsDroppedArr.splice(i, 1);
                            console.log("Removed: " + packetsDroppedArr[i]);
                        }
                    }

                    return dropped;
                }
                
                




                while (lastPacketSent <= totalToSend) {
                    var sendString = "Currently Sending: ";
                    console.log("RTT: " + RTT);
                    console.log("Congestion Window: " + congestionWindow + "\n");
                    currentlySendArray = [];
                    var dropped = false;
                    
                    
                    
                   
                    
                    // Sending Output --------------------------------------------------------------
                    var myNode = document.getElementById("sendOutPutList");
                    

                    
//                     if(document.getElementById("outputPacketList")){
//                         myNode.removeChild(myNode.firstChild);
//                    }
                    
                     myNode = document.getElementById("sendOutPutList");

                    
                    var ul=document.createElement("ul");
                    ul.setAttribute("id", "outputPacketList");
                    ul.setAttribute("class", "outPutListDiv");

                    
                    
                    //----------------------------------------------------------------------------------
                    var textnode = document.createTextNode("RTT #" + RTT);
                    var node = document.createElement("li");
                    node.setAttribute("id", "packetsSent");
                    node.appendChild(textnode);
                    ul.appendChild(node);
                    
                    for (var i = 0; i < congestionWindow; i++) {
                        currentlySendArray[i] = lastPacketSent;
                        
                         textnode = document.createTextNode(currentlySendArray[i]);
                         node = document.createElement("li");
                        node.appendChild(textnode);
                        
                        node.setAttribute("class", "droppedPacketRed");
                        
                        if(isDropped(currentlySendArray[i])){
                              node.style.backgroundColor = "#d11e1e";
                        node.style.color = "white";
                        }
                      
                        if (currentlySendArray[i] <= totalToSend)
                         ul.appendChild(node);
                        
                        


                        if (dropped == false) {
                            dropped = isDropped(currentlySendArray[i]);
                            if (dropped == false)
                                lastPacketSent++;
                        }



                        //                                        console.log("Last Packet Sent: " + lastPacketSent + "\t + "+i+ " =  "+ (lastPacketSent + i));

                        if (currentlySendArray[i] <= totalToSend)
                            sendString += (currentlySendArray[i] + ", ");
                    }
                    
                    myNode.appendChild(ul);

                    console.log(sendString + "\n");
                    console.log("\n");



                    if (dropped == false) {
                        outputData.push(congestionWindow);
                        congestionWindow++;

                    } else {
                        outputData.push(congestionWindow);
                        congestionWindow = Math.floor(congestionWindow / 2);

                    }
                    RTT++;
                }



                return outputData;
            }

            function slowStart() {

            }

            // Click function for packet drops 
            document.getElementById("packetList").addEventListener("click", function(e) {
                var size = document.getElementById("packetDroppedList").getElementsByTagName("li").length;
                var alreadyDropped = false;
                
                // e.target is our targetted element.
                if (e.target && e.target.nodeName == "LI") {
                    e.target.style.backgroundColor = "#ff1b1b";
                    e.target.style.color = "white";

              
                    
                        for (var i = 0; i < packetsDroppedArray.length; i++) {
                        if (packetsDroppedArray[i] == Number(e.target.innerHTML)) {
                            alreadyDropped = true;
                        }
                    }
                    
                    
                    
                    if(alreadyDropped == false){
                    // push to our array of dropped packets
                    packetsDroppedArray.push(Number(e.target.innerHTML));
                    }
                    else {
                    
                    var index = packetsDroppedArray.indexOf(Number(e.target.innerHTML));
                    packetsDroppedArray.splice(index, 1);
                    e.target.style.backgroundColor = "#e2e2e2";
                    e.target.style.color = "black";
                    }
                    
                    
                    // sort our dropped packets
                    packetsDroppedArray.sort(function(a, b) {
                        return a - b
                    });
                    
//                    var output = "";
//                    for (var i = 0; i < packetsDroppedArray.length; i++) {
//                        output += packetsDroppedArray[i] + ", ";
//                    }

                    //        // Clear our packetlist by removing all child nodes
                    var myNode = document.getElementById("packetDroppedList");
                    while (document.getElementById("packetDroppedList").getElementsByTagName("li").length > 1) {
                        myNode.removeChild(myNode.lastChild);
                    }
                    //        // Add to packets dropped list 
                    for (var i = 0; i < packetsDroppedArray.length; i++) {
                        var node = document.createElement("li");
                        var textnode = document.createTextNode(packetsDroppedArray[i]);
                        node.appendChild(textnode);
                        document.getElementById("packetDroppedList").appendChild(node);
                    }

                    // Run AIMD and Slow Start
                    var aimdData = AIMD(packetsDroppedArray);
                    var aimdLabel = new Array();
                    for (var i = 1; i < aimdData.length; i++) {
                        aimdLabel.push(i);
                    }
                    myChart.data.datasets[0].data = aimdData;
                    myChart.data.labels = aimdLabel;
                    myChart.update();



                }
            });
        </script>

    </div>

    <div id="analysisSection">

        <div id="aimdAnalysis">
            <div class="analysisTitle">
                <p>AIMD Analysis</p>
                
                <div class="SentDroppedDiv">
                <p>Packages Sent: <p id="aimdPackSent" class="analysisPackInfo">46</p>
                <p>Packages Dropped: <p id="aimdPackSent" class="analysisPackInfo noBorder">5</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Packages Size: <p id="aimdPackSent" class="analysisPackInfo noBorder">1500 KB</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Largest Congestion Window: <p id="aimdPackSent" class="analysisPackInfo noBorder">16</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Max RTT #: <p id="aimdPackSent" class="analysisPackInfo">46</p>
                <p>Total Transmission Time: <p id="aimdPackSent" class="analysisPackInfo noBorder">51 ms</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Throughput: <p id="aimdPackSent" class="analysisPackInfo noBorder">16 bps</p>
                </div>
                
                <div class="SentDroppedDiv" id="outputList">
                <p>Sending Output:</p>
                    <div id="sendOutPutList">
   
                    </div>
                </div>
                
                
            </div>
        </div>

        <div id="slowStartAnalysis">
            <div class="analysisTitle">
                <p>Slow Start Analysis</p>
                
                                <div class="SentDroppedDiv">
                <p>Packages Sent: <p id="aimdPackSent" class="analysisPackInfo">46</p>
                <p>Packages Dropped: <p id="aimdPackSent" class="analysisPackInfo">5</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Packages Size: <p id="aimdPackSent" class="analysisPackInfo noBorder">1500 KB</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Largest Congestion Window: <p id="aimdPackSent" class="analysisPackInfo noBorder">16</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Max RTT #: <p id="aimdPackSent" class="analysisPackInfo">46</p>
                <p>Total Transmission Time: <p id="aimdPackSent" class="analysisPackInfo">51 ms</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Throughput: <p id="aimdPackSent" class="analysisPackInfo noBorder">16 bps</p>
                </div>
                
                <div class="SentDroppedDiv">
                <p>Sending Output:</p>
                </div>
            </div>
        </div>



    </div>


    <!------------------------------------------------------------------------------------------------->

</body>

</html>
